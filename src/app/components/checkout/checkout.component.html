<div class="checkout-container">
  <h1>Checkout</h1>
  
  <mat-stepper #stepper [linear]="true" orientation="vertical">
    
    <!-- Step 1: Customer Information -->
    <mat-step [stepControl]="customerForm" label="Customer Information">
      <form [formGroup]="customerForm">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="firstName" required>
            <mat-error *ngIf="customerForm.get('firstName')?.hasError('required')">
              First name is required
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="lastName" required>
            <mat-error *ngIf="customerForm.get('lastName')?.hasError('required')">
              Last name is required
            </mat-error>
          </mat-form-field>
        </div>
        
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" type="email" required>
            <mat-error *ngIf="customerForm.get('email')?.hasError('required')">
              Email is required
            </mat-error>
            <mat-error *ngIf="customerForm.get('email')?.hasError('email')">
              Please enter a valid email
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Phone</mat-label>
            <input matInput formControlName="phone" required>
            <mat-error *ngIf="customerForm.get('phone')?.hasError('required')">
              Phone is required
            </mat-error>
          </mat-form-field>
        </div>
        
        <div class="step-actions">
          <button mat-raised-button color="primary" matStepperNext 
                  [disabled]="!customerForm.valid">
            Next
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Step 2: Shipping Address -->
    <mat-step [stepControl]="shippingForm" label="Shipping Address">
      <form [formGroup]="shippingForm">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Street Address</mat-label>
          <input matInput formControlName="street" required>
        </mat-form-field>
        
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" required>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>State</mat-label>
            <input matInput formControlName="state" required>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>ZIP Code</mat-label>
            <input matInput formControlName="zipCode" required>
          </mat-form-field>
        </div>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Country</mat-label>
          <mat-select formControlName="country" required>
            <mat-option value="US">United States</mat-option>
            <mat-option value="CA">Canada</mat-option>
            <mat-option value="MX">Mexico</mat-option>
          </mat-select>
        </mat-form-field>
        
        <div class="step-actions">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" matStepperNext 
                  [disabled]="!shippingForm.valid">
            Next
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Step 3: Payment Method -->
    <mat-step [stepControl]="paymentForm" label="Payment Method">
      <form [formGroup]="paymentForm">
        <mat-radio-group formControlName="paymentType" class="payment-options">
          <mat-radio-button value="credit_card">Credit Card</mat-radio-button>
          <mat-radio-button value="debit_card">Debit Card</mat-radio-button>
          <mat-radio-button value="paypal">PayPal</mat-radio-button>
        </mat-radio-group>
        
        <div *ngIf="paymentForm.get('paymentType')?.value === 'credit_card' || 
                    paymentForm.get('paymentType')?.value === 'debit_card'" 
             class="card-details">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Card Holder Name</mat-label>
            <input matInput formControlName="cardHolderName">
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Card Number</mat-label>
            <input matInput formControlName="cardNumber" placeholder="1234 5678 9012 3456">
          </mat-form-field>
          
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Expiry Date</mat-label>
              <input matInput formControlName="expiryDate" placeholder="MM/YY">
            </mat-form-field>
            
            <mat-form-field appearance="outline">
              <mat-label>CVV</mat-label>
              <input matInput formControlName="cvv" placeholder="123" maxlength="4">
            </mat-form-field>
          </div>
        </div>
        
        <div class="step-actions">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" matStepperNext 
                  [disabled]="!paymentForm.valid">
            Next
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Step 4: Order Review -->
    <mat-step label="Review Order">
      <div class="order-review">
        <h3>Order Summary</h3>
        
        <div class="order-items">
          <div *ngFor="let item of cartItems$ | async" class="order-item">
            <img [src]="getProductImages(item)[0]" [alt]="item.product.name" class="item-image">
            <div class="item-details">
              <h4>{{ item.product.name }}</h4>
              <p>Quantity: {{ item.quantity }}</p>
              <p class="item-price">{{ item.product.price | currency }}</p>
            </div>
            <div class="item-total">
              {{ (item.product.price * item.quantity) | currency }}
            </div>
          </div>
        </div>
        
        <div class="order-totals">
          <div class="total-row">
            <span>Subtotal:</span>
            <span>{{ orderSummary?.subtotal | currency }}</span>
          </div>
          <div class="total-row">
            <span>Tax:</span>
            <span>{{ orderSummary?.tax | currency }}</span>
          </div>
          <div class="total-row">
            <span>Shipping:</span>
            <span>{{ orderSummary?.shipping | currency }}</span>
          </div>
          <div class="total-row final-total">
            <span>Total:</span>
            <span>{{ orderSummary?.total | currency }}</span>
          </div>
        </div>
        
        <div class="step-actions">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" 
                  (click)="processCheckout()" 
                  [disabled]="isProcessing">
            <mat-spinner diameter="20" *ngIf="isProcessing"></mat-spinner>
            {{ isProcessing ? 'Processing...' : 'Place Order' }}
          </button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</div>